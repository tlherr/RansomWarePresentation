<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>Adventures with Ransomware</title>

	<meta name="description" content="Adventures with Ransomware">
	<meta name="author" content="Thomas Herr">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/moon.css" id="theme">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>

	<!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
</head>

<body>

<div class="reveal">

	<!-- Any section element inside of this container is displayed as a slide -->
	<div class="slides">
		<section>
			<h1>Ransomware</h1>
			<h3>Having fun with digital extortion</h3>
			<p>
				<small>Created by <a href="https://tlherr.com">Thomas Herr</a></small>
				<br>
				<small>NETS1037-18W-22342</small>
			</p>
		</section>

		<section>
			<h2>What is it?</h2>

			<p>Everyone has heard of this</p>
			<p>Anyone experienced it?</p>
			<p>Encrypts data, wont release without payment</p>

			<aside class="notes">

			</aside>
		</section>


		<section>
			<h2>Brief History</h2>

			<p>First known <i>"malware extortion"</i> attack 1989</p>
			<p>Asymmetric Encryption usage in attacks in 1996</p>

			<h4>Notable Examples</h4>
			<table class="text-sm">
				<thead>
				<tr>
					<th>Date</th>
					<th>Name</th>
					<th>Type</th>
					<th>Targets</th>
				</tr>
				</thead>
				<tbody>
				<tr>
					<td>2006</td>
					<td>Gpcode</td>
					<td>Trojan</td>
					<td>Windows</td>
				</tr>
				<tr>
					<td>2010</td>
					<td>Winlock</td>
					<td>Trojan</td>
					<td>Windows</td>
				</tr>
				<tr>
					<td>2013</td>
					<td>Cryptolocker</td>
					<td>Trojan</td>
					<td>Windows</td>
				</tr>
				<tr>
					<td>2017</td>
					<td>Badrabbit</td>
					<td>Trojan</td>
					<td>Windows</td>
				</tr>
				</tbody>
			</table>


			<aside class="notes">

			</aside>
		</section>

		<section>
			<h2>Our Focus</h2>

			<p>WannaCryptor aka WannaCry and variants</p>
			<p>Modern Ransomware in general</p>
		</section>

		<section>
			<h2>How does it work?</h2>
			<ul>
				<li>Once infected files are encrypted (methods vary)</li>
				<li>User is prompted for payment to bitcoin address</li>
				<li>Differing threats</li>
			</ul>
		</section>

		<section>
			<h2>Popular propagation method</h2>
			<small>CVE-2017-0144</small>

			<blockquote class="text-sm" style="width: 100%;">
				There is a buffer overflow memmove operation in Srv!SrvOs2FeaToNt. The size
				is calculated in Srv!SrvOs2FeaListSizeToNt, with mathematical error where a
				DWORD is subtracted into a WORD. The kernel pool is groomed so that overflow
				is well laid-out to overwrite an SMBv1 buffer. Actual RIP hijack is later
				completed in srvnet!SrvNetWskReceiveComplete.
			</blockquote>

			<p class="text-sm">Kernel functions Srv!SrvOs2FeaToNt and SrvNetWskReceiveComplete serv.sys<br/>
			dword is an unsigned, 32-bit unit of data<br/>
			word is an unsigned 16-bit integer</p>
		</section>


		<section>
			<h2>Lets install some!</h2>
			<ul>

			</ul>
		</section>

		<section data-background="https://media.giphy.com/media/LRVnPYqM8DLag/giphy.gif">
			<h3>
				<span class="fragment highlight highlight-red fade-up">What</span>
				<span class="fragment highlight highlight-red fade-up">could</span>
				<span class="fragment highlight highlight-red fade-up">possibly</span>
				<span class="fragment highlight highlight-red fade-up">go</span>
				<span class="fragment highlight highlight-red fade-up">wrong</span>
			</h3>
		</section>


		<!-- Example of nested vertical slides -->
		<section>
			<section>
				<h2>Setup</h2>
				<p>Protect against propagation</p>
				<p>Have Backups</p>
				<p>Accept risk of a damaged drive</p>
				<br>
				<a href="#" class="navigate-down">
					<img width="178" height="238" data-src="https://s3.amazonaws.com/hakim-static/reveal-js/arrow.png" alt="Down arrow">
				</a>
			</section>
			<section>
				<h2>Precautions</h2>
				<ul>
					<li><strike>EXSI</strike> VMware Workstation</li>
					<li>Snapshots</li>
					<li>New Hard Drive</li>
					<li>Complete Network Disconnect</li>
				</ul>
			</section>
			<section data-markdown>
				<h2>Malware Samples:</h2>
				<br>
				<p>https://github.com/ytisf/theZoo/tree/master/malwares/Binaries</p>

				<ul>
					<li>Ransomware.Cerber</li>
					<li>Ransomware.Cryptowall</li>
					<li>Ransomware.Jigsaw</li>
					<li>Ransomware.Locky</li>
					<li>Ransomware.Mamba</li>
					<li>Ransomware.Matsnu</li>
					<li>Ransomware.Petrwrap</li>
					<li>Ransomware.Petya</li>
					<li>Ransomware.Radamant</li>
					<li>Ransomware.Rex</li>
					<li>Ransomware.Satana </li>
					<li>Ransomware.TeslaCrypt</li>
					<li>Ransomware.Vipasana</li>
					<li>Ransomware.WannaCry</li>
					<li>Ransomware.WannaCry_Plus</li>
				</ul>

			</section>

			<section>
				<h2>Testing Hosts</h2>
				<ul>
					<li>Windows XP</li>
					<li>Windows 7</li>
					<li>Windows 8.1</li>
				</ul>
				<br>
			</section>

			<section data-background-image="assets/img/win_xp_version_info.png" data-background-size="contain">

			</section>

			<section data-background-image="assets/img/win_7_version_info.png" data-background-size="contain">

			</section>

			<section data-background-image="assets/img/win_8.1-version_info.png" data-background-size="contain">

			</section>
		</section>

		<section>
			<h2>Setup</h2>

			<p>Configure All Windows Hosts to:</p>
			<ul>
				<li>ship logs</li>
				<li>snmp/traps</li>
			</ul>
			<p>Windows XP could not setup snmp...</p>
		</section>

		<section>
			<h2>Expectations</h2>
			<ul>
				<li>Large increase in error messages</li>
				<li>File I/O errors</li>
				<li>Not Found Errors</li>
				<li>Rise in Disk I/O during crypto locking</li>
			</ul>
		</section>

		<section>
			<h2>Attack Vectors</h2>

			<code>
				auxiliary/scanner/smb/smb_ms17_010
				exploit/windows/smb/ms17_010_eternalblue
			</code>

			<p>Email, HTTP Download etc. also work</p>
		</section>

		<section>
			<h2>Attack Methodology</h2>

			<ul>
				<li>Start from clean snapshots</li>
				<li>Bring up router, service machines then hosts</li>
				<li>Run for 5 mins (get baseline activity etc.)</li>
				<li>Launch Attack</li>
				<li>Dump Database for Analysis</li>
				<li>Capture SNMP monitoring info</li>
			</ul>

		</section>

		<section>
			<h2>Scanning Results</h2>

			<code>
				nmap -Pn -p 445 --script smb-vuln-ms17-010 192.168.132.0/24
			</code>

			<pre>
Host script results:
| smb-vuln-ms17-010:
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
			</pre>

			<p>Windows 7 (132.7), Windows 8 (132.8)</p>

		</section>

		<section>
			<h2 style="color:red;">Where is XP?!?!</h2>

			<iframe src="https://giphy.com/embed/5b5OU7aUekfdSAER5I" width="480" height="388" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/snl-saturday-night-live-kenan-thompson-5b5OU7aUekfdSAER5I"></a></p>

		</section>

		<section data-background-image="assets/img/lol_xp_firewall.png" data-background-size="contain">

		</section>

		<section>
			<section>
				<h2>Attack 1</h2>
				<p>Variant: WannaCry</p>
				<br>
				<a href="#" class="navigate-down">
					<img width="178" height="238" data-src="https://s3.amazonaws.com/hakim-static/reveal-js/arrow.png" alt="Down arrow">
				</a>
			</section>
			<section>
				<h2>Setup</h2>

				<img src="assets/img/wannacry_setup_1.png">


			</section>

			<section data-background-image="assets/img/fail_1.png" data-background-size="contain">

			</section>

			<section>
				<h1>:(</h1>
			</section>


			<section>
				<h2>Round 2</h2>

				<img src="assets/img/attack_1_result.png">
			</section>

			<section>
				<h2>Observations</h2>

				<ul>
					<li>No other hosts infected</li>
					<li>Almost no evidence that attack happened</li>
					<li>All that build up, for what!</li>
				</ul>

			</section>

			<section data-background-image="assets/img/attack_1_log_results.png" data-background-size="contain">

			</section>

			<section data-background-image="assets/img/attack_1_disk_io.png" data-background-size="contain">

			</section>


			<section>
				<h2>Evidence Summary</h2>

				<ul>
					<li>No visible evidence that machine was infected</li>
					<li>Not what I expected</li>
					<li>Windows SNMP did not have disk IO on by default</li>
					<li>Is that all you got?</li>
				</ul>

				<a href="#/2">
					<img width="178" height="238" data-src="https://s3.amazonaws.com/hakim-static/reveal-js/arrow.png" alt="Up arrow" style="transform: rotate(180deg); -webkit-transform: rotate(180deg);">
				</a>
			</section>
		</section>

		<section>
			<h2>That sucked, I wanted destruction!</h2>
			<p><strong>Petya encrypts a hard drive's file system table and prevents Windows from booting</strong></p>
			<p>That sounds fun</p>
		</section>



		<section>
			<section>
				<h2>Attack 2</h2>
				<p>Variant: Petya</p>
				<br>
				<a href="#" class="navigate-down">
					<img width="178" height="238" data-src="https://s3.amazonaws.com/hakim-static/reveal-js/arrow.png" alt="Down arrow">
				</a>
			</section>
			<section>
				<h2>Result</h2>

				<div style="position:relative;height:0;padding-bottom:56.25%"><iframe src="https://www.youtube.com/embed/9Slu7dmopsA?ecver=2" width="640" height="360" frameborder="0" allow="autoplay; encrypted-media" style="position:absolute;width:100%;height:100%;left:0" allowfullscreen></iframe></div>

			</section>

			<section data-background-image="assets/img/attack_2_result.png" data-background-size="contain">

			</section>

			<section data-background-image="assets/img/attack_2_alert.png" data-background-size="contain">

			</section>

			<section>
				<h2>Still no log entries to catch :(</h2>
			</section>

			<section>
				<h2>Evidence</h2>
				<ul>
					<li>Host rebooted (big red flag)</li>
					<li>Did not come back up after it went down (Even bigger red flag)</li>
					<li>Still disappointing, none of these have spread to other machines or been as noisy as expected</li>
				</ul>

				<a href="#/2">
					<img width="178" height="238" data-src="https://s3.amazonaws.com/hakim-static/reveal-js/arrow.png" alt="Up arrow" style="transform: rotate(180deg); -webkit-transform: rotate(180deg);">
				</a>
			</section>
		</section>

		<section>
			<h2>Disappointment, lets try something else</h2>

			<p>Cerber, Jigsaw, Zerolocker</p>
		</section>

		<section>
			<h2>Video (Play Fast Forward)</h2>

			<div style="position:relative;height:0;padding-bottom:56.25%"><iframe src="https://www.youtube.com/embed/IovXEqSGsT0?ecver=2" width="640" height="360" frameborder="0" allow="autoplay; encrypted-media" style="position:absolute;width:100%;height:100%;left:0" allowfullscreen></iframe></div>
		</section>

		<section>
			<h2>Evidence (Cerber)</h2>

			<ul>
				<li>Next to nothing in terms of evidence</li>
				<li>Only targeted documents, system files fine</li>
			</ul>
		</section>

		<section>
			<h2>Evidence (Jigsaw)</h2>

			<ul>
				<li>Next to nothing in terms of evidence</li>
				<li>Only targeted documents, system files fine</li>
				<li>Spikes of Disk IO and CPU while it performs a task</li>
			</ul>
		</section>


		<section>
			<h2>Evidence (Zerolocker)</h2>

			<p>My Personal Favourite</p>
		</section>


		<section data-background-image="assets/img/attack_3_disk_io.png" data-background-size="contain">

		</section>

		<section data-background-image="assets/img/attack_3_cipher_disk_io.png" data-background-size="contain">

		</section>

		<section data-background-image="assets/img/attack_3_disk_filling_up.png" data-background-size="contain">

		</section>

		<section data-background-image="assets/img/attack_3_disk_usage_overview.png" data-background-size="contain">

		</section>


		<section data-background-image="assets/img/attack_3_90_disk.png" data-background-size="contain">

		</section>

		<section>
			<h2>Why write so much?</h2>

			<p class="fragment fade-in">Makes recovery much harder</p>
		</section>


		<section>
			<h1>Mitigation</h1>

			<ul>
				<li>Updates</li>
				<li>Reduce Attack Surface (Disable SMB if not in use)</li>
				<li>Implement monitoring solutions that actually help, not just create noise</li>
				<li>Have baselines to compare against</li>
			</ul>
		</section>

		<section>
			<div style="background-color: rgba(0, 0, 0, 0.9); color: #fff; padding: 20px;">
				<h2>References</h2>
				<ul>
					<li>https://blog.trendmicro.com/trendlabs-security-intelligence/ms17-010-eternalblue/</li>
					<li>https://support.eset.com/ca6443/?locale=en_US&viewlocale=en_US</li>
					<li>https://www.endgame.com/blog/technical-blog/wcrywanacry-ransomware-technical-analysis</li>
					<li>https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/smb/ms17_010_eternalblue.rb</li>
				</ul>
			</div>
		</section>

		<section style="text-align: left;">
			<h1>THE END</h1>
			<h3>Questions?</h3>

			<img src="assets/img/lolsleep.png">
		</section>

	</div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        slideNumber: true,

        transition: 'convex', // none/fade/slide/convex/concave/zoom

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
            { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
            { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
            { src: 'plugin/search/search.js', async: true },
            { src: 'plugin/zoom-js/zoom.js', async: true },
            { src: 'plugin/notes/notes.js', async: true }
        ]
    });

</script>

</body>
</html>
